##### distr_builder.sh has the following commands  

`--task create | update`  
Required parameter which activates one of two available modes: *creation* of image from scratch or *updating* internals of image/block device in relation with give parameters.  

`--configuration <path>`  
Required parameter in case of creation mode. The parameter specifies path to a configuration file.  
The configuration file can consist of the following set of parameters:  
```
PARAM_PATH_IDBLOCK				/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/images/idblock.bin
PARAM_PATH_UBOOT				/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/images/uboot.img
PARAM_PATH_UBOOT_ENV_TXT		/abs_path/distr_builder/uboot.env.txt
PARAM_PATH_LINUX_KERNEL			/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/images/Image
PARAM_PATH_DTB					/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/images/atb-rk3568j-smc-r1.dtb
PARAM_PATH_BUSYBOX_ROOTFS		/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/images/rootfs.cpio.gz
PARAM_PATH_EXTERNAL_ROOTFS		/abs_path/distr_builder/distribution/ubuntu18.04-lxde.rootfs.ext4
PARAM_PATH_OVERLAY 				/abs_path/distr_builder/atb_rk3568j_smc_r1/atb_rk3568j_smc_r1/overlay
PARAM_PATH_LINUX_MODULES		/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/target/lib/modules
PARAM_PATH_UBOOTTOOLS 			/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/build/uboot-ok_r1/tools
PARAM_PATH_GENIMAGE 			/abs_path/distr_builder/buildroot/output/atb_rk3568j_smc_r1/host/bin/genimage
PARAM_PATH_GENIMAGE_CFG			/abs_path/distr_builder/distr_image.cfg
```
Parameter `PARAM_PATH_LINUX_MODULES` is an absolute path to `/lib/modules` directory being created during deploying buildroot rootfs and consists of linux kernel modules.  
Parameter `PARAM_PATH_UBOOTTOOLS` is an absolute path to utilities compiled together with u-boot and used for different purposes of image creation.  
Parameter `PARAM_PATH_GENIMAGE` is an absolute path to `genimage` utility being used by buildroot to create final image.  
Parameter `PARAM_PATH_GENIMAGE_CFG` is an absolute path to configuration file which describes internal structure of being created image.  
Parameter `PARAM_PATH_EXTERNAL_ROOTFS`  is an absolute path to raw image of root file system of required distribution (e.g. ubuntu, debian etc.). The distribution can be created by yourself or obtaind from a site of developer.  

`--destination <path>`  
Required parameter in case of updating mode. The parameter specify path to image file of block device which internals will be updated.  

`--linux <path>`  
Parameter specifies path to linux kernel file. The parameter overrides related one in configuration file if it is specified.  

`--linux_modules <path>`  
Parameter specifies path to a directory which contains linux kernel modules. The parameter overrides related one in configuration file if it is specified.  

`--uboot_env_txt <path>`  
Parameter specifies path to file which contains environment variables of u-boot. The parameter overrides related one in configuration file if it is specified.  

`--uboot <path>`  
Parameter specifies path to u-boot image file being built by buildroot. The parameter overrides related one in configuration file if it is specified.  

`--dtb <path>`  
Parameter specifies path to device tree blob file for linux kernel. The parameter overrides related one in configuration file if it is specified.  

`--idblock <path>`  
Parameter specifies path to the first stage bootloader being built by buildroot. The parameter overrides related one in configuration file if it is specified.  

`--overlay <path>`  
Parameter specifies path to a directory with subdirectories wich will be copied into root of root file system. The parameter overrides related one in configuration file if it is specified.  

`--busybox_rootfs <path>`  
Parameter specifies path to a root file system being generated by buildroot. The parameter overrides related one in configuration file if it is specified.  

`--external_rootfs <path>`  
Parameter specifies path to a root file system for example ubuntu/debian e.t.c.. The parameter overrides related one in configuration file if it is specified.  

`--uboot_tools <path>`  
Parameter specifies path to tools which are built with u-boot and are used for different purposes. The parameter overrides related one in configuration file if it is specified.  

`--genimage <path>`  
Parameter specifies path to a genimage utility to create final image. The parameter overrides related one in configuration file if it is specified.  

`--genimage_cfg <path>`  
Parameter specifies path to a configuration file for genimage utility which describes structure of final image. The parameter overrides related one in configuration file if it is specified.  


Create image from scratch using configuration file.  
```bash
./distr_builder.sh --task create --configuration ./path/atb_rk3568j_smc_r1_ubuntu_minimal.cfg
```

Update existing image using configuration file and using block device as a source for modification.  
```bash
./distr_builder.sh --task update --configuration ./path/atb_rk3568j_smc_r1_ubuntu_minimal.cfg --destination /dev/mmcblk1
```

Update existing image using certain parameters and using block device as a source for modification.  
```bash
./distr_builder.sh --task update --linux_modules ./path/lib/modules --uboot_env_txt ./path/uboot_env.txt --destination /dev/sda
```

Update existing image using certain parameters and using image file as a source for modification.  
```bash
./distr_builder.sh --task update --idblock ./path/idblock.bin --uboot ./path/uboot --destination ./path/usd.img
```

Update existing image using configuration file and certain parameters and using block device as a source for modification.  
In this case parameters `--overlay` and `--linux_modules` override the same parameters in configuration file.  
```bash
./distr_builder.sh --task update --configuration ./path/atb_rk3568j_smc_r1_ubuntu_minimal.cfg --destination /dev/mmcblk1 --overlay ./path/overlay --linux_modules ./path/lib/modules
```


For creating image from scratch all of these parameters are required.  
For updating only certain parameters are required. It depends on a purpose of updating.  
Absolute pathes are required.  

The following files are generated during buildroot building process:  
`idblock.bin`  
`uboot.img`  
`Image`  
`atb-rk3568j-smc-r1.dtb`  
`rootfs.cpio.gz`  

##### To create image it needs to do the following steps:  
1. obtain building system `git clone https://git1.atb-e.ru/cpu_soft/build_systems/distr_builder.git distr_builder`  
2. go into directory `cd distr_builder`  
3. obtain buildroot `git clone https://git1.atb-e.ru/cpu_soft/build_systems/atb-buildroot-main.git buildroot`  
4. go into directory `cd buildroot`  
5. configure and build base image  
```
make O=output/atb_rk3568j_smc_r1 atb_rk3568j_smc_r1_linux-5.10.110_defconfig
make O=output/atb_rk3568j_smc_r1
```
or
```
make O=output/atb_rk3568j_mpc atb_rk3568j_mpc_linux-5.10.110_defconfig
make O=output/atb_rk3568j_mpc
```
or
```
make O=output/atb_rk3568c_mpc_m atb_rk3568c_mpc_m_linux-5.10.110_defconfig
make O=output/atb_rk3568c_mpc_m
```
6. leave directory `cd ..`  
7. download distribution `ubuntu18.04-lxde.rootfs.ext4` into directory `distribution`  
8. create directory `mkdir atb_rk3568j_smc_r1` and go into `cd atb_rk3568j_smc_r1`  
9. create configuration file `atb_rk3568j_smc_r1_ubuntu18.04_lxde.cfg`  
10. fill the created configuration file as mentioned earlier  
11. leave directory `cd ..`  
10. create image `./distr_builder.sh --task create --configuration atb_rk3568j_smc_r1/atb_rk3568j_smc_r1_ubuntu18.04_lxde.cfg`  
11. write created image into uSD-card `dd if=atb_rk3568j_smc_r1_ubuntu18.04_lxde_tmp/atb_rk3568j_smc_r1_ubuntu18.04_lxde_usd.img of=/dev/sdX status=progress bs=1M`  


The following distribution:  
`debian10-lxde.rootfs.ext4"`  
`debian10-xfce4.rootfs.ext4"`  
`ubuntu18.04-lxde.rootfs.ext4`  
`ubuntu20.04-lxqt.rootfs.ext4`  
`ubuntu20.04-minimal.rootfs.ext4`  
can be downloaded using the command `wget -T 1 --ftp-user='atbftp_user' --ftp-password='32Vj_hy%c@gR' ftp://ftp.atb-e.ru:2121/ATB_FTP/buildroot/<DISTRIBUTION>`
